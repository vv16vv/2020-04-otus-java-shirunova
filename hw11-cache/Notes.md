# Домашнее задание HW11-cache

## Описание
Тест `StressCacheTest` содержит 2 тестовых метода 
- `readManyUsers` - работа с DBServiceUser без кэша
- `readManyCachedUsers` - работа с DBServiceUser c кэшом.

Каждый тест записывает 10000 записей в базу данных и затем их читает.  

## Результаты
Были проведены измерения длительности теста и вычисления изменения производительности при разных значениях размера heap памяти.
Для каждого значения памяти было проведено по 5 измерений, усредненные значения приведены в таблицах ниже.

Изменение производительности вычислялось по следующей формуле:
> (`Время работы без кэша` - `Время работы с кэшом`) / `Время работы без кэша` * 100%

### Параметры памяти `-Xmx50m -Xms50m`

| Тест | Общее время работы теста, с | Увеличение производительности, % | Время работы GC, c | Доля времени GC, % |
| --- | --- | --- | --- | --- |
| без кэша | 14.241 | - | 0.217 | 1.52 % |
| с кэшом | 11.378 | на 20.12 % | 0.189 | 1.67 % |

### Параметры памяти `-Xmx20m -Xms20m`

| Тест | Общее время работы теста, с | Увеличение производительности, % | Время работы GC, c | Доля времени GC, % |
| --- | --- | --- | --- | --- |
| без кэша | 18.648 | - | 0.730 | 3.92 % |
| с кэшом | 15.454 | 17.12 % | 0.778 | 5.03 % |

### Параметры памяти `-Xmx15m -Xms15m`

| Тест | Общее время работы теста, с | Увеличение производительности, % | Время работы GC, c | Доля времени GC, % |
| --- | --- | --- | --- | --- |
| без кэша | 20.564 | - | 2.154 | 10.48 % |
| с кэшом | 15.204 | на 26.05 % | 2.095 | 13.80 % |

### Параметры памяти `-Xmx10m -Xms10m`

| Тест | Общее время работы теста, с | Увеличение производительности, % | Время работы GC, c | Доля времени GC, % |
| --- | --- | --- | --- | --- |
| без кэша | 201.448 | - | 181.512  | 90.10 % |
| с кэшом | 199.846 | на 0.80 % | 183.179 | 91.66 % |

## Выводы

Использование кэша позволяет ускорить доступ к данным - в данном тесте в среднем на 20%.

Аномальные значения времени работы теста при размере heap 10М объясняются тем, что основная часть времени уходит на garbage collection - порядка 90%. Для кэшированных данных даже чуть больше.
Из-за нехватки памяти объекты в кэше не задерживаются и быстро освобождаются. А сам кэш вносит дополнительную нагрузку на память и поэтому некоторые запуски показали ухудшение времени с использованием кэша, чем без него.

Разброс значений увеличения производительности в остальных случаях объясняется скорее погрешностью измерений вследствие небольшого числа измерений, а также другими факторами - влияние IDE, в рамках которой совершались запуски, загрузка процессора другими приложения и т.п.

## Необработанные данные измерений
### `-Xmx50m -Xms50m`							
| Тест | Параметр | 1 | 2 | 3 | 4 | 5 | Среднее |
| --- | --- | --- | --- | --- | --- | --- | --- |
without cache |	test time |	14.704 |	13.908 |	14.089 |	13.894 |	14.609 |	14.2408
| | gc time | 0.215 | 0.209 | 0.217 | 0.227 | 0.215 | 0.2166
| | gc part	|1.46%	|1.50%	|1.54%	|1.63%	|1.47%	|1.52%
with cache	|test time	|12.347|	10.572|	11.853|	10.955|	11.165|	11.3784
| |	gc time|	0.203|	0.186|	0.197|	0.169|	0.192|	0.1894
| |	gc part|	1.64%|	1.76%|	1.66%|	1.54%|	1.72%|	1.67%
	acceleration| |	16.03%|	23.99%|	15.87%|	21.15%|	23.57%|	20.12%
							
### `-Xmx20m -Xms20m`							
| Тест | Параметр | 1 | 2 | 3 | 4 | 5 | Среднее |
| --- | --- | --- | --- | --- | --- | --- | --- |
without cache|	test time|	18.866|	18.757|	18.244|	18.949|	18.423|	18.6478
| |	gc time|	0.73|	0.749|	0.751|	0.696|	0.724|	0.73
| |	gc part|	3.87%|	3.99%|	4.12%|	3.67%|	3.93%|	3.92%
with cache|	test time|	15.178|	16.176|	15.292|	15.428|	15.198|	15.4544
| |	gc time|	0.805|	0.801|	0.766|	0.765|	0.751|	0.7776
| | gc part|	5.30%|	4.95%|	5.01%|	4.96%|	4.94%|	5.03%
	acceleration| |	19.55%|	13.76%|	16.18%|	18.58%|	17.51%|	17.12%
							
### `-Xmx15m -Xms15m`							
| Тест | Параметр | 1 | 2 | 3 | 4 | 5 | Среднее |
| --- | --- | --- | --- | --- | --- | --- | --- |
without cache|	test time|	20.897|	20.703|	19.928|	20.792|	20.499|	20.5638
| |	gc time|	2.224|	2.204|	2.077|	2.1|	2.167|	2.1544
| |	gc part|	10.64%|	10.65%|	10.42%|	10.10%|	10.57%|	10.48%
with cache|	test time|	14.663|	15.272|	15.067|	15.405|	15.6|	15.2014
| |	gc time|	2.221|	2.196|	2.059|	1.962|	2.036|	2.0948
| |	gc part|	15.15%|	14.38%|	13.67%|	12.74%|	13.05%|	13.80%
	acceleration| |	29.83%|	26.23%|	24.39%|	25.91%|	23.90%|	26.05%
							
### `-Xmx10m -Xms10m`							
| Тест | Параметр | 1 | 2 | 3 | 4 | 5 | Среднее |
| --- | --- | --- | --- | --- | --- | --- | --- |
without cache|	test time|	201.263|	201.488|	201.619|	201.305|	201.563|	201.4476
| |	gc time|	181.602|	181.599|	181.745|	181.031|	181.582|	181.5118
| |	gc part|	90.23%|	90.13%|	90.14%|	89.93%|	90.09%|	90.10%
with cache|	test time|	196.786|	202.34|	202.645|	198.363|	199.098|	199.8464
| |	gc time|	180.746|	185.245|	185.624|	182.181|	182.098|	183.1788
| |	gc part|	91.85%|	91.55%|	91.60%|	91.84%|	91.46%|	91.66%
	acceleration| |	2.22%|	-0.42%|	-0.51%|	1.46%|	1.22%|	0.80%
							
### Память без ограничений							
| Тест | Параметр | 1 | 2 | 3 | 4 | 5 | Среднее |
| --- | --- | --- | --- | --- | --- | --- | --- |
without cache|	test time|	14.651|	13.489|	13.512|	12.708|	13.435|	13.559
| |	gc time|	0.12|	0.118|	0.124|	0.123|	0.116|	0.1202
| |	gc part|	0.82%|	0.87%|	0.92%|	0.97%|	0.86%|	0.89%
with cache|	test time|	10.637|	10.452|	11.222|	10.324|	10.386|	10.6042
| |	gc time|	0.071|	0.074|	0.06|	0.064|	0.07|	2.232
| |	gc part|	0.67%|	0.71%|	0.53%|	0.62%|	0.67%|	0.64%
	acceleration| |	27.40%|	22.51%|	16.95%|	18.76%|	22.69%|	21.66%
